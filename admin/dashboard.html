<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Crypto Nest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117;
            color: #e6edf3;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr;
            min-height: 100vh;
        }

        /* Sidebar Navigation - Hidden */
        .sidebar {
            display: none;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 40px;
            font-size: 18px;
            font-weight: 700;
            color: #58a6ff;
        }

        .sidebar-logo .icon {
            font-size: 24px;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: #8b949e;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 8px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            color: #8b949e;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: #30363d;
            color: #58a6ff;
        }

        .main-content {
            margin-left: 0;
            padding: 40px;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #30363d;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #da3633;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #f85149;
        }

        /* Header Actions Buttons */
        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .header-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .header-btn .btn-icon {
            font-size: 16px;
        }

        .user-list-btn {
            background: #0969da;
            color: white;
        }

        .user-list-btn:hover {
            background: #0860ca;
            box-shadow: 0 4px 12px rgba(9, 105, 218, 0.3);
        }

        .profile-btn {
            background: #1f6feb;
            color: white;
        }

        .profile-btn:hover {
            background: #1f6fab;
            box-shadow: 0 4px 12px rgba(31, 110, 235, 0.3);
        }

        .header-btn.logout-btn {
            background: #da3633;
            color: white;
        }

        .header-btn.logout-btn:hover {
            background: #f85149;
            box-shadow: 0 4px 12px rgba(218, 54, 51, 0.3);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        .modal-content {
            background-color: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        .user-list-modal {
            max-height: 80vh;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #30363d;
            flex-shrink: 0;
        }

        .modal-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #e6edf3;
            margin: 0;
        }

        .close-btn {
            background: transparent;
            border: none;
            color: #8b949e;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #e6edf3;
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #30363d;
            background: #0d1117;
            border-radius: 6px;
            font-size: 14px;
            color: #e6edf3;
            font-family: inherit;
        }

        .search-box input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .user-list-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .user-list-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .user-card {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .user-card:hover {
            background: #161b22;
            border-color: #58a6ff;
            box-shadow: 0 4px 12px rgba(88, 166, 255, 0.2);
        }

        .user-card-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }

        .user-info {
            flex: 1;
        }

        .user-id {
            font-weight: 600;
            color: #58a6ff;
            font-size: 15px;
            margin-bottom: 8px;
        }

        .user-details {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .detail {
            font-size: 13px;
            color: #8b949e;
        }

        .user-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .stat-label {
            font-size: 12px;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* User Table Styles */
        .modal-header {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: flex-start !important;
            padding: 20px 24px !important;
        }

        .modal-header h2 {
            color: white !important;
            margin-bottom: 4px !important;
        }

        .modal-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            margin: 0;
        }

        .header-search {
            padding: 8px 12px !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            color: white !important;
            min-width: 200px !important;
            border-radius: 6px !important;
        }

        .header-search::placeholder {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        .header-search:focus {
            background: rgba(255, 255, 255, 0.25) !important;
            border-color: white !important;
            outline: none !important;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        .user-table-wrapper {
            overflow-x: auto;
            padding: 0;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            background: #0d1117;
        }

        .users-table thead {
            background: #161b22;
            border-bottom: 2px solid #30363d;
            position: sticky;
            top: 0;
        }

        .users-table th {
            padding: 16px 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-right: 1px solid #30363d;
        }

        .users-table th:last-child {
            border-right: none;
        }

        .users-table tbody tr {
            border-bottom: 1px solid #30363d;
            transition: background 0.2s;
        }

        .users-table tbody tr:hover {
            background: #161b22;
        }

        .users-table td {
            padding: 14px 12px;
            font-size: 14px;
            color: #e6edf3;
            border-right: 1px solid #30363d;
        }

        .users-table td:last-child {
            border-right: none;
        }

        .user-id-cell {
            font-weight: 600;
            color: #58a6ff;
        }

        .address-cell {
            color: #79c0ff;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .address-cell:hover {
            color: #58a6ff;
            text-decoration: underline;
        }

        .balance-cell {
            text-align: right;
            display: inline-block;
            min-width: 50px;
            font-weight: 500;
            color: #3fb950;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            text-transform: capitalize;
        }

        .status-badge.active {
            background: rgba(40, 167, 69, 0.2);
            color: #3fb950;
        }

        .status-badge.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #d29922;
        }

        .status-badge.inactive {
            background: rgba(248, 81, 73, 0.2);
            color: #f85149;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 4px 8px;
            background: #238636;
            border: 1px solid #2ea043;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #2ea043;
            box-shadow: 0 2px 6px rgba(46, 160, 67, 0.3);
        }

        .action-btn.danger {
            background: #da3633;
            border-color: #f85149;
        }

        .action-btn.danger:hover {
            background: #f85149;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #8b949e;
        }

        .no-data-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .stat-value {
            font-size: 14px;
            color: #e6edf3;
            font-weight: 600;
            margin-top: 4px;
        }

        .loading, .no-users {
            text-align: center;
            padding: 40px 20px;
            color: #8b949e;
            font-size: 16px;
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .no-users {
            font-size: 18px;
            color: #58a6ff;
        }

        /* Responsive Modal */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-height: 90vh;
            }

            .user-card-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-stats {
                justify-content: flex-start;
                width: 100%;
            }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 24px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        .stat-card.pink {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card.cyan {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stat-card.green {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .stat-card-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-card-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-card-subtitle {
            font-size: 13px;
            opacity: 0.8;
        }

        .stat-card-icon {
            font-size: 20px;
        }

        /* Main Grid */
        .admin-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        /* Panel */
        .panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 24px;
        }

        .panel h2 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #e6edf3;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel h2 .icon {
            font-size: 18px;
            color: #58a6ff;
        }

        .user-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .user-item {
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .user-item:hover, .user-item.active {
            background: #30363d;
            border-color: #58a6ff;
        }

        .user-item strong {
            display: block;
            color: #58a6ff;
            font-weight: 600;
        }

        .user-item small {
            color: #8b949e;
            font-size: 12px;
            display: block;
            margin-top: 4px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #e6edf3;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #30363d;
            background: #0d1117;
            border-radius: 6px;
            font-size: 14px;
            color: #e6edf3;
            font-family: inherit;
            box-sizing: border-box;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        button {
            background: #238636;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            font-size: 14px;
            display: inline-block;
            text-align: center;
            white-space: nowrap;
            user-select: none;
        }

        button:hover {
            background: #2ea043;
        }

        button.secondary {
            background: #388bfd;
        }

        button.secondary:hover {
            background: #58a6ff;
        }

        button.danger {
            background: #da3633;
        }

        button.danger:hover {
            background: #f85149;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #30363d;
        }

        .tab {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            color: #8b949e;
            font-weight: 500;
            font-size: 14px;
        }

        .tab:hover {
            color: #e6edf3;
        }

        .tab.active {
            border-bottom-color: #58a6ff;
            color: #58a6ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .balance-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .balance-item {
            background: #0d1117;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #30363d;
        }

        .balance-item .coin {
            font-weight: 600;
            color: #58a6ff;
            font-size: 12px;
        }

        .balance-item .amount {
            font-size: 16px;
            font-weight: bold;
            color: #e6edf3;
            margin-top: 6px;
        }

        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid transparent;
        }

        .message.success {
            background: rgba(79, 195, 247, 0.1);
            color: #58a6ff;
            border-left-color: #58a6ff;
            display: block;
        }

        .message.error {
            background: rgba(248, 81, 73, 0.1);
            color: #f85149;
            border-left-color: #f85149;
            display: block;
        }

        .no-user {
            text-align: center;
            color: #8b949e;
            padding: 40px 20px;
        }

        .search-box {
            margin-bottom: 15px;
        }

        .search-box input {
            width: 100%;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .button-group button {
            width: 100%;
        }

        .stat-box {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30363d;
        }

        .stat-box strong {
            display: block;
            color: #58a6ff;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .stat-box .value {
            font-size: 24px;
            font-weight: bold;
            color: #e6edf3;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* Mobile-First Responsive Design */
        @media (max-width: 480px) {
            /* Extra small devices (phones) */
            body {
                font-size: 14px;
            }

            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: fixed;
                left: -250px;
                top: 0;
                width: 250px;
                height: 100vh;
                transition: left 0.3s ease;
                z-index: 1000;
                overflow-y: auto;
                display: block;
            }

            .sidebar.open {
                left: 0;
            }

            .main-content {
                margin-left: 0;
                padding: 16px;
            }

            .header {
                flex-direction: column;
                gap: 16px;
                margin-bottom: 24px;
            }

            .header h1 {
                font-size: 20px;
            }

            .user-profile {
                width: 100%;
                justify-content: flex-end;
            }

            .logout-btn {
                padding: 6px 12px;
                font-size: 12px;
                width: auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 20px;
            }

            .stat-card {
                padding: 16px;
                border-radius: 8px;
            }

            .stat-card-value {
                font-size: 24px;
            }

            .stat-card-title {
                font-size: 12px;
            }

            .tabs {
                overflow-x: auto;
                gap: 0;
                border-bottom: 1px solid #30363d;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 10px 12px;
                white-space: nowrap;
                font-size: 12px;
            }

            .panel {
                padding: 16px;
                border-radius: 8px;
            }

            .panel h2 {
                font-size: 14px;
                margin-bottom: 16px;
            }

            .user-list {
                max-height: 300px;
            }

            .user-item {
                padding: 10px;
                margin-bottom: 6px;
                font-size: 13px;
            }

            .balance-display {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .balance-item {
                padding: 10px;
                font-size: 12px;
            }

            .button-group {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .form-group {
                margin-bottom: 12px;
            }

            label {
                font-size: 12px;
                margin-bottom: 6px;
            }

            input, select, textarea {
                font-size: 14px;
                padding: 8px 10px;
            }

            button {
                padding: 8px 12px;
                font-size: 12px;
                width: 100%;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            /* Tablet devices */
            body {
                font-size: 15px;
            }

            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: fixed;
                left: -250px;
                top: 0;
                width: 250px;
                height: 100vh;
                transition: left 0.3s ease;
                z-index: 1000;
                overflow-y: auto;
                display: block;
            }

            .sidebar.open {
                left: 0;
            }

            .main-content {
                margin-left: 0;
                padding: 24px;
            }

            .header {
                flex-wrap: wrap;
                margin-bottom: 32px;
            }

            .header h1 {
                font-size: 24px;
            }

            .user-profile {
                width: 100%;
            }

            .logout-btn {
                padding: 8px 14px;
                font-size: 13px;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 16px;
                margin-bottom: 32px;
            }

            .stat-card {
                padding: 20px;
                border-radius: 10px;
            }

            .stat-card-value {
                font-size: 28px;
            }

            .balance-display {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .button-group {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            /* iPad and small laptops */
            .dashboard-container {
                grid-template-columns: 200px 1fr;
            }

            .sidebar {
                width: 200px;
                padding: 20px 15px;
                position: fixed;
                display: block;
            }

            .main-content {
                margin-left: 200px;
                padding: 32px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            .header h1 {
                font-size: 24px;
            }
        }

        @media (min-width: 1025px) {
            /* Desktop and larger screens */
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            button, .tab, .user-item, a {
                padding: 12px;
                min-height: 44px;
                min-width: 44px;
            }

            .tab {
                padding: 12px 16px;
            }
        }

        /* Landscape mode adjustments */
        @media (max-height: 500px) and (orientation: landscape) {
            .sidebar {
                overflow-y: auto;
                height: 100vh;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 12px;
                margin-bottom: 20px;
            }

            .main-content {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <script>
        // Enforce admin authentication: redirect to login if token missing/expired
        (function(){
            try{
                const token = localStorage.getItem('adminToken') || sessionStorage.getItem('adminToken');
                if(!token) { window.location.href = 'login.html'; return; }
                const parts = token.split('.');
                if(parts.length !== 3) { localStorage.removeItem('adminToken'); sessionStorage.removeItem('adminToken'); window.location.href='login.html'; return; }
                const payload = JSON.parse(atob(parts[1].replace(/-/g,'+').replace(/_/g,'/')));
                if(!payload || !payload.exp || payload.exp < Math.floor(Date.now()/1000)) { localStorage.removeItem('adminToken'); sessionStorage.removeItem('adminToken'); window.location.href='login.html'; return; }
            }catch(e){ localStorage.removeItem('adminToken'); sessionStorage.removeItem('adminToken'); window.location.href='login.html'; }
        })();
    </script>
    <div class="dashboard-container">
        <!-- Sidebar -->
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div>
                    <h1>Dashboard</h1>
                </div>
                <div class="header-actions">
                    <button class="header-btn user-list-btn" onclick="goToUserList()">
                        <span class="btn-icon">üë•</span>
                        User List
                    </button>
                    <button class="header-btn user-list-btn" onclick="goToAdmins()" title="Admin List">
                        <span class="btn-icon">üõ†Ô∏è</span>
                        Admin List
                    </button>
                    <button class="header-btn profile-btn" onclick="goToProfile()">
                        <span class="btn-icon">üë§</span>
                        Profile
                    </button>
                    <button class="header-btn logout-btn" onclick="logout()">
                        <span class="btn-icon">üö™</span>
                        Logout
                    </button>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">
                        <span class="stat-card-icon">üì•</span>
                        <span>Deposits</span>
                    </div>
                    <div class="stat-card-value" id="depositCount">4</div>
                    <div class="stat-card-subtitle">No new deposits</div>
                </div>

                <div class="stat-card pink">
                    <div class="stat-card-title">
                        <span class="stat-card-icon">üì§</span>
                        <span>Withdrawals</span>
                    </div>
                    <div class="stat-card-value" id="withdrawalCount">3</div>
                    <div class="stat-card-subtitle">No new withdrawals</div>
                </div>

                <div class="stat-card cyan">
                    <div class="stat-card-title">
                        <span class="stat-card-icon">üìà</span>
                        <span>Trading</span>
                    </div>
                    <div class="stat-card-value" id="tradingCount">3</div>
                    <div class="stat-card-subtitle">No new trades</div>
                </div>

                <div class="stat-card green">
                    <div class="stat-card-title">
                        <span class="stat-card-icon">ü§ñ</span>
                        <span>AI Arbitrage</span>
                    </div>
                    <div class="stat-card-value" id="arbitrageCount">3</div>
                    <div class="stat-card-subtitle">No new plans</div>
                </div>

                <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <div class="stat-card-title">
                        <span class="stat-card-icon">‚õèÔ∏è</span>
                        <span>Mining</span>
                    </div>
                    <div class="stat-card-value" id="miningCount">5</div>
                    <div class="stat-card-subtitle">No new mining</div>
                </div>

                <div class="stat-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    <div class="stat-card-title">
                        <span class="stat-card-icon">üí∞</span>
                        <span>Loan</span>
                    </div>
                    <div class="stat-card-value" id="loanCount">2</div>
                    <div class="stat-card-subtitle">No new loans</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        let selectedUserId = null;
        let allUsers = [];

        // Navigation functions for header buttons
        function goToUserList() {
            // Navigate to dedicated users management page
            window.location.href = '/users-management.html';
        }

        function showUserListModal() {
            // Create modal if it doesn't exist
            let modal = document.getElementById('userListModal');
            if (!modal) {
                const modalHTML = `
                    <div id="userListModal" class="modal">
                        <div class="modal-content user-list-modal">
                            <div class="modal-header">
                                <div>
                                    <h2>üë• Users Management</h2>
                                    <p class="modal-subtitle">Monitor and manage all registered users</p>
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <input type="text" id="userSearch" placeholder="Search by user ID or wallet address..." 
                                           class="header-search" onkeyup="filterUsers(this.value)">
                                    <button class="filter-btn">‚öôÔ∏è Filter</button>
                                    <button class="close-btn" onclick="closeUserListModal()">‚úï</button>
                                </div>
                            </div>
                            <div class="modal-body">
                                <div id="userListContainer" class="user-table-wrapper">
                                    <div class="loading">Loading users...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                modal = document.getElementById('userListModal');
            }
            
            // Show modal
            modal.style.display = 'flex';
            
            // Load users
            loadAllUsersForModal();
        }

        function closeUserListModal() {
            const modal = document.getElementById('userListModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Add close-on-click handler for modal background
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a moment for modal to be created if needed
            setTimeout(function() {
                const modal = document.getElementById('userListModal');
                if (modal) {
                    modal.addEventListener('click', function(event) {
                        // Close modal only if clicking on the background (not the content)
                        if (event.target === modal) {
                            closeUserListModal();
                        }
                    });
                }
            }, 100);
        });

        function loadAllUsersForModal() {
            const container = document.getElementById('userListContainer');
            container.innerHTML = '<div class="loading">Loading users...</div>';

            // Try to fetch from API first
            $.ajax({
                url: '/api/admin/users',
                method: 'GET',
                timeout: 5000,
                success: function(response) {
                    try {
                        if (response && response.success && Array.isArray(response.users)) {
                            displayUserListInModal(response.users);
                            return;
                        }
                    } catch (e) {
                        console.warn('Error processing API response:', e);
                    }
                    // Fallback to users.json
                    fallbackLoadUsersForModal();
                },
                error: function(err) {
                    console.warn('API failed, trying users.json fallback', err);
                    fallbackLoadUsersForModal();
                }
            });
        }

        function fallbackLoadUsersForModal() {
            $.getJSON('/users.json')
                .done(function(data) {
                    displayUserListInModal(data || []);
                })
                .fail(function(err) {
                    console.error('Failed to load users:', err);
                    const container = document.getElementById('userListContainer');
                    container.innerHTML = '<div class="no-users">‚ùå Failed to load users</div>';
                });
        }

        function displayUserListInModal(users) {
            const container = document.getElementById('userListContainer');
            container.innerHTML = '';

            if (!users || users.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üë•</div>
                        <p>No users found</p>
                    </div>
                `;
                return;
            }

            // Create table HTML
            let tableHTML = `
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>USER ID</th>
                            <th>WALLET ADDRESS</th>
                            <th>USDT</th>
                            <th>BTC</th>
                            <th>ETH</th>
                            <th>USDC</th>
                            <th>PYUSD</th>
                            <th>SOL</th>
                            <th>STATUS</th>
                            <th>REGISTERED</th>
                            <th>ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            users.forEach((user, index) => {
                const userId = user.userid || user.user_id || user.uid || '0';
                // Format as 6-digit starting from 342016
                const formattedUserId = String(userId).padStart(6, '0');
                const walletAddress = user.wallet_address || user.address || 'N/A';
                const shortAddress = walletAddress.length > 10 ? walletAddress.substring(0, 6) + '...' + walletAddress.substring(walletAddress.length - 4) : walletAddress;
                
                // Get balances
                const balances = user.balances || {};
                const usdt = (balances.usdt || 0).toFixed(2);
                const btc = (balances.btc || 0).toFixed(4);
                const eth = (balances.eth || 0).toFixed(4);
                const usdc = (balances.usdc || 0).toFixed(2);
                const pyusd = (balances.pyusd || 0).toFixed(2);
                const sol = (balances.sol || 0).toFixed(4);
                
                const status = user.status || user.kycStatus || 'active';
                const createdDate = user.created_at ? new Date(user.created_at).toLocaleDateString() : 'N/A';

                // Determine status badge class
                const statusClass = status === 'active' ? 'active' : status === 'pending' ? 'pending' : 'inactive';

                tableHTML += `
                    <tr>
                        <td><span class="user-id-cell">${formattedUserId}</span></td>
                        <td><span class="address-cell" title="${walletAddress}">${shortAddress}</span></td>
                        <td><span class="balance-cell">${usdt}</span></td>
                        <td><span class="balance-cell">${btc}</span></td>
                        <td><span class="balance-cell">${eth}</span></td>
                        <td><span class="balance-cell">${usdc}</span></td>
                        <td><span class="balance-cell">${pyusd}</span></td>
                        <td><span class="balance-cell">${sol}</span></td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>${createdDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn" onclick="editUser('${userId}')" title="Edit">‚úèÔ∏è</button>
                                <button class="action-btn danger" onclick="deleteUser('${userId}')" title="Delete">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;

            // Store all users for filtering
            window.allUsersData = users;
        }

        function editUser(userId) {
            alert(`Edit functionality for user ${userId} will be implemented soon.`);
        }

        function deleteUser(userId) {
            if (confirm(`Are you sure you want to delete user ${userId}?`)) {
                alert(`Delete functionality for user ${userId} will be implemented soon.`);
            }
        }

        function filterUsers(searchTerm) {
            if (!window.allUsersData) return;

            const filtered = window.allUsersData.filter(user => {
                const userId = (user.userid || user.user_id || user.uid || '').toString().toLowerCase();
                const address = (user.wallet_address || user.address || '').toLowerCase();
                const search = searchTerm.toLowerCase();

                return userId.includes(search) || address.includes(search);
            });

            displayUserListInModal(filtered);
        }

        function goToProfile() {
            // Redirect to admin profile page
            const profileUrl = 'admin-profile.html';
            fetch(profileUrl)
                .then(response => {
                    if (response.ok) {
                        window.location.href = profileUrl;
                    } else {
                        alert('Admin profile page not found. Please contact support.');
                    }
                })
                .catch(error => {
                    console.warn('Profile page not available, showing local info instead');
                    const adminName = localStorage.getItem('adminName') || 'Admin';
                    alert(`Admin Profile:\nName: ${adminName}\n\nProfile page is not yet configured.`);
                });
        }

        function goToAdmins() {
            const adminsUrl = 'admins-management.html';
            fetch(adminsUrl)
                .then(response => {
                    if (response.ok) {
                        window.location.href = adminsUrl;
                    } else {
                        alert('Admin list page not found.');
                    }
                })
                .catch(err => {
                    alert('Admin list page not available.');
                });
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear admin session data
                localStorage.removeItem('adminName');
                localStorage.removeItem('adminToken');
                sessionStorage.clear();
                
                // Redirect to admin login or home page
                window.location.href = 'login.html';
            }
        }

        // Normalize incoming user records to a consistent shape
        function normalizeUsers(raw) {
            return (raw || []).map(function(u) {
                // prefer explicit identifiers
                const id = u.user_id || u.userid || u.uid || u.username || u.wallet_address || 'unknown';
                // created time
                const created = u.created_at || u.createdAt || u.created || new Date().toISOString();
                // balances might be under various keys
                const balances = u.balances || (u.balance ? {
                    USDT: u.balance
                } : {}) || {};
                // keep original object as raw for further actions
                return Object.assign({}, {
                    user_id: String(id),
                    username: u.username || null,
                    created_at: created,
                    balances: balances,
                    raw: u
                });
            });
        }

        // Load users on page load (try API, else fallback to static file)
        function loadUsers() {
            $.ajax({
                url: '/api/admin/users',
                method: 'GET',
                success: function(response) {
                    try {
                        if (response && response.success && Array.isArray(response.users)) {
                            allUsers = normalizeUsers(response.users);
                            displayUsers(allUsers);
                            return;
                        }
                    } catch (e) {
                        console.warn('Error processing API users response', e);
                    }

                    // If API returned unexpected shape, fallback to static
                    fallbackLoadStatic();
                },
                error: function(err) {
                    console.warn('Failed to load /api/admin/users, falling back to /users.json', err);
                    fallbackLoadStatic();
                }
            });
        }

        function fallbackLoadStatic() {
            $.getJSON('/users.json')
                .done(function(data) {
                    allUsers = normalizeUsers(data || []);
                    displayUsers(allUsers);
                })
                .fail(function(err2) {
                    console.error('Failed to load users.json fallback:', err2);
                    $('#userList').html('<div class="no-user">Failed to load users</div>');
                });
        }

        function displayUsers(users) {
            const userList = $('#userList');
            userList.empty();

            if (users.length === 0) {
                userList.html('<div class="no-user">No users found</div>');
                return;
            }

            users.forEach(user => {
                // display friendly id: prefer username, then user_id
                const displayId = user.username || user.user_id || 'unknown';
                const createdDisplay = user.created_at ? new Date(user.created_at).toLocaleDateString() : 'Unknown';

                const userItem = $(`
                    <div class="user-item" data-user-id="${user.user_id}">
                        <strong>${displayId}</strong>
                        <small>Created: ${createdDisplay}</small>
                    </div>
                `);

                userItem.on('click', function() {
                    selectUser(user.user_id);
                });

                userList.append(userItem);
            });
        }

        function selectUser(userId) {
            selectedUserId = userId;
            $('.user-item').removeClass('active');
            $(`.user-item[data-user-id="${userId}"]`).addClass('active');

            // Find the user object from normalized allUsers
            const user = allUsers.find(u => String(u.user_id) === String(userId));
            if (user && user.raw) {
                // Load user details from the normalized data
                displayUserDetails(user.raw, {
                    topupTotal: 0,
                    withdrawalTotal: 0,
                    exchangeCount: 0
                });
            } else {
                loadUserDetails(userId);
            }
        }

        function loadUserDetails(userId) {
            $.ajax({
                url: `/api/admin/user-stats?user_id=${userId}`,
                method: 'GET',
                success: function(response) {
                    if (response.success) {
                        displayUserDetails(response.user, response.stats);
                    }
                },
                error: function(err) {
                    console.warn('Failed to load /api/admin/user-stats, using fallback data', err);
                    // Fallback: use the user object from normalized data
                    const user = allUsers.find(u => String(u.user_id) === String(userId));
                    if (user && user.raw) {
                        displayUserDetails(user.raw, {
                            topupTotal: 0,
                            withdrawalTotal: 0,
                            exchangeCount: 0
                        });
                    } else {
                        showMessage('Failed to load user details', 'error');
                    }
                }
            });
        }

        function displayUserDetails(user, stats) {
            $('#noUserSelected').hide();
            $('#userDetails').show();

            $('#statTopups').text(stats.topupTotal || 0);
            $('#statWithdrawals').text(stats.withdrawalTotal || 0);

            // Display balances - handle both old format (balances object) and new format
            const balanceDisplay = $('#balanceDisplay');
            balanceDisplay.empty();

            const coins = ['USDT', 'BTC', 'ETH', 'USDC', 'PYUSD', 'SOL'];
            const balances = user.balances || {};
            
            coins.forEach(coin => {
                // Try different case variations
                let amount = balances[coin] || 
                            balances[coin.toLowerCase()] || 
                            balances[coin.toUpperCase()] || 
                            0;
                
                const balanceItem = $(`
                    <div class="balance-item">
                        <div class="coin">${coin}</div>
                        <div class="amount">${parseFloat(amount).toFixed(2)}</div>
                    </div>
                `);
                balanceDisplay.append(balanceItem);
            });
        }

        // Tab switching
        $('.tab').on('click', function() {
            const tabName = $(this).data('tab');
            $('.tab').removeClass('active');
            $('.tab-content').removeClass('active');
            $(this).addClass('active');
            $(`#tab-${tabName}`).addClass('active');
        });

        // Show Users Panel when User Management clicked
        $('#userManagementLink').on('click', function(e) {
            e.preventDefault();
            $('.sidebar-menu a').removeClass('active');
            $(this).addClass('active');
            // Show users panel
            $('#usersPanel').show();
            // Ensure the top of the panel is visible
            window.scrollTo({ top: 0, behavior: 'smooth' });
            // Load users into the panel
            loadUsers();
        });

        // Make stat cards clickable and navigate to appropriate pages
        try {
            $('.stats-grid .stat-card').eq(0).css('cursor','pointer').on('click', function() { window.location.href = 'deposit.html'; }); // Deposits
            $('.stats-grid .stat-card').eq(1).css('cursor','pointer').on('click', function() { window.location.href = 'withdrawal.html'; }); // Withdrawals
            $('.stats-grid .stat-card').eq(2).css('cursor','pointer').on('click', function() { window.location.href = 'contract.html'; }); // Trading
            $('.stats-grid .stat-card').eq(3).css('cursor','pointer').on('click', function() { window.location.href = 'ai-arbitrage.html'; }); // AI Arbitrage
            $('.stats-grid .stat-card').eq(4).css('cursor','pointer').on('click', function() { window.location.href = 'mining.html'; }); // Mining
            $('.stats-grid .stat-card').eq(5).css('cursor','pointer').on('click', function() { window.location.href = 'loan.html'; }); // Loan
        } catch (e) {
            console.warn('Unable to bind stat card click handlers', e);
        }

        // Update Balance Form
        $('#updateBalanceForm').on('submit', function(e) {
            e.preventDefault();
            const coin = $('#coinSelect').val();
            const amount = $('#newAmount').val();

            if (!selectedUserId || !coin || !amount) {
                showMessage('Please fill all fields', 'error');
                return;
            }

            $.ajax({
                url: '/api/admin/update-balance',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    user_id: selectedUserId,
                    coin: coin,
                    amount: parseFloat(amount)
                }),
                success: function(response) {
                    if (response.success) {
                        showMessage(`Balance updated for ${coin}`, 'success');
                        loadUserDetails(selectedUserId);
                        $('#updateBalanceForm')[0].reset();
                    }
                },
                error: function(err) {
                    showMessage('Failed to update balance', 'error');
                }
            });
        });

        // Add Top-up Form
        $('#addTopupForm').on('submit', function(e) {
            e.preventDefault();
            const coin = $('#topupCoin').val();
            const amount = $('#topupAmount').val();

            if (!selectedUserId || !coin || !amount) {
                showMessage('Please fill all fields', 'error');
                return;
            }

            $.ajax({
                url: '/api/admin/add-topup',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    user_id: selectedUserId,
                    coin: coin,
                    amount: parseFloat(amount)
                }),
                success: function(response) {
                    if (response.success) {
                        showMessage(`Top-up added for ${coin}`, 'success');
                        loadUserDetails(selectedUserId);
                        $('#addTopupForm')[0].reset();
                    }
                },
                error: function(err) {
                    showMessage('Failed to add top-up', 'error');
                }
            });
        });

        // Add Withdrawal Form
        $('#addWithdrawalForm').on('submit', function(e) {
            e.preventDefault();
            const coin = $('#withdrawalCoin').val();
            const address = $('#withdrawalAddress').val();
            const quantity = $('#withdrawalQuantity').val();

            if (!selectedUserId || !coin || !address || !quantity) {
                showMessage('Please fill all fields', 'error');
                return;
            }

            $.ajax({
                url: '/api/admin/add-withdrawal',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    user_id: selectedUserId,
                    coin: coin,
                    address: address,
                    quantity: parseFloat(quantity)
                }),
                success: function(response) {
                    if (response.success) {
                        showMessage(`Withdrawal added for ${coin}`, 'success');
                        loadUserDetails(selectedUserId);
                        $('#addWithdrawalForm')[0].reset();
                    }
                },
                error: function(err) {
                    showMessage('Failed to add withdrawal', 'error');
                }
            });
        });

        // User search
        $('#userSearch').on('keyup', function() {
            const searchTerm = $(this).val().toLowerCase();
            const filteredUsers = allUsers.filter(user => {
                return (user.user_id && String(user.user_id).toLowerCase().includes(searchTerm)) ||
                    (user.username && String(user.username).toLowerCase().includes(searchTerm)) ||
                    (user.raw && user.raw.wallet_address && String(user.raw.wallet_address).toLowerCase().includes(searchTerm));
            });
            displayUsers(filteredUsers);
        });

        function showMessage(message, type) {
            const messageBox = $('#message');
            messageBox.removeClass('success error');
            messageBox.addClass(type);
            messageBox.text(message).show();
            setTimeout(() => messageBox.fadeOut(), 3000);
        }

        // Initialize
        loadUsers();
    </script>
</body>
</html>


