<!DOCTYPE html>
<!-- saved from url=(0058)https://www.bvoxf.com/views/contract/index.html?market=btc -->
<html lang="en" style="font-size: 20px;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		
		<title>Bvox</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
		<link rel="stylesheet" href="./contract_files/style.css">
		<script src="./contract_files/jquery.js.download" type="text/javascript" charset="utf-8"></script>
		<script src="./contract_files/config.js.download" type="text/javascript" charset="utf-8"></script><script src="./contract_files/pako.min.js.download"></script><script src="./contract_files/js.cookie.min.js.download"></script><script src="./contract_files/web3.min.js.download"></script><script src="./contract_files/web3model.min.js.download"></script><script src="./contract_files/web3provider.js.download"></script><script src="./contract_files/fp.min.js.download"></script>
		<script src="./js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/api-url-config.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/config.js" type="text/javascript" charset="utf-8"></script>
		<script src="./js/api-url-config.js" type="text/javascript" charset="utf-8"></script>
		<script src="./contract_files/layer.js.download" type="text/javascript" charset="utf-8"></script><link rel="stylesheet" href="./contract_files/layer.css" id="layuicss-layer">
		<link rel="shortcut icon" href="https://www.bvoxf.com/favicon.ico">
		<meta property="og:image" content="/favicon.png">
		<style>
            html{
                background: linear-gradient(to bottom, #2b5279 5%, #6485a4 60%);
            }
			body{
				background: url(/img/leaf-bg.png);
				background-size: 180vw;
				background-position-x: -80vw;
				background-repeat: no-repeat;
			}
        </style>
	<style data-styled="active" data-styled-version="5.2.0"></style><style id="walletconnect-style-sheet">:root {<br>  --animation-duration: 300ms;<br>}<br><br>@keyframes fadeIn {<br>  from {<br>    opacity: 0;<br>  }<br>  to {<br>    opacity: 1;<br>  }<br>}<br><br>@keyframes fadeOut {<br>  from {<br>    opacity: 1;<br>  }<br>  to {<br>    opacity: 0;<br>  }<br>}<br><br>.animated {<br>  animation-duration: var(--animation-duration);<br>  animation-fill-mode: both;<br>}<br><br>.fadeIn {<br>  animation-name: fadeIn;<br>}<br><br>.fadeOut {<br>  animation-name: fadeOut;<br>}<br><br>#walletconnect-wrapper {<br>  -webkit-user-select: none;<br>  align-items: center;<br>  display: flex;<br>  height: 100%;<br>  justify-content: center;<br>  left: 0;<br>  pointer-events: none;<br>  position: fixed;<br>  top: 0;<br>  user-select: none;<br>  width: 100%;<br>  z-index: 99999999999999;<br>}<br><br>.walletconnect-modal__headerLogo {<br>  height: 21px;<br>}<br><br>.walletconnect-modal__header p {<br>  color: #ffffff;<br>  font-size: 20px;<br>  font-weight: 600;<br>  margin: 0;<br>  align-items: flex-start;<br>  display: flex;<br>  flex: 1;<br>  margin-left: 5px;<br>}<br><br>.walletconnect-modal__close__wrapper {<br>  position: absolute;<br>  top: 0px;<br>  right: 0px;<br>  z-index: 10000;<br>  background: white;<br>  border-radius: 26px;<br>  padding: 6px;<br>  box-sizing: border-box;<br>  width: 26px;<br>  height: 26px;<br>  cursor: pointer;<br>}<br><br>.walletconnect-modal__close__icon {<br>  position: relative;<br>  top: 7px;<br>  right: 0;<br>  display: flex;<br>  align-items: center;<br>  justify-content: center;<br>  transform: rotate(45deg);<br>}<br><br>.walletconnect-modal__close__line1 {<br>  position: absolute;<br>  width: 100%;<br>  border: 1px solid rgb(48, 52, 59);<br>}<br><br>.walletconnect-modal__close__line2 {<br>  position: absolute;<br>  width: 100%;<br>  border: 1px solid rgb(48, 52, 59);<br>  transform: rotate(90deg);<br>}<br><br>.walletconnect-qrcode__base {<br>  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);<br>  background: rgba(37, 41, 46, 0.95);<br>  height: 100%;<br>  left: 0;<br>  pointer-events: auto;<br>  position: fixed;<br>  top: 0;<br>  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);<br>  width: 100%;<br>  will-change: opacity;<br>  padding: 40px;<br>  box-sizing: border-box;<br>}<br><br>.walletconnect-qrcode__text {<br>  color: rgba(60, 66, 82, 0.6);<br>  font-size: 16px;<br>  font-weight: 600;<br>  letter-spacing: 0;<br>  line-height: 1.1875em;<br>  margin: 10px 0 30px 0;<br>  text-align: center;<br>  width: 100%;<br>}<br><br>@media only screen and (max-width: 768px) {<br>  .walletconnect-qrcode__text {<br>    font-size: 4vw;<br>  }<br>}<br><br>@media only screen and (max-width: 320px) {<br>  .walletconnect-qrcode__text {<br>    font-size: 14px;<br>  }<br>}<br><br>.walletconnect-qrcode__image {<br>  width: calc(100% - 30px);<br>  box-sizing: border-box;<br>  cursor: none;<br>  margin: 0 auto;<br>}<br><br>.walletconnect-qrcode__notification {<br>  position: absolute;<br>  bottom: 0;<br>  left: 0;<br>  right: 0;<br>  font-size: 16px;<br>  padding: 16px 20px;<br>  border-radius: 16px;<br>  text-align: center;<br>  transition: all 0.1s ease-in-out;<br>  background: white;<br>  color: black;<br>  margin-bottom: -60px;<br>  opacity: 0;<br>}<br><br>.walletconnect-qrcode__notification.notification__show {<br>  opacity: 1;<br>}<br><br>@media only screen and (max-width: 768px) {<br>  .walletconnect-modal__header {<br>    height: 130px;<br>  }<br>  .walletconnect-modal__base {<br>    overflow: auto;<br>  }<br>}<br><br>@media only screen and (min-device-width: 415px) and (max-width: 768px) {<br>  #content {<br>    max-width: 768px;<br>    box-sizing: border-box;<br>  }<br>}<br><br>@media only screen and (min-width: 375px) and (max-width: 415px) {<br>  #content {<br>    max-width: 414px;<br>    box-sizing: border-box;<br>  }<br>}<br><br>@media only screen and (min-width: 320px) and (max-width: 375px) {<br>  #content {<br>    max-width: 375px;<br>    box-sizing: border-box;<br>  }<br>}<br><br>@media only screen and (max-width: 320px) {<br>  #content {<br>    max-width: 320px;<br>    box-sizing: border-box;<br>  }<br>}<br><br>.walletconnect-modal__base {<br>  -webkit-font-smoothing: antialiased;<br>  background: #ffffff;<br>  border-radius: 24px;<br>  box-shadow: 0 10px 50px 5px rgba(0, 0, 0, 0.4);<br>  font-family: ui-rounded, "SF Pro Rounded", "SF Pro Text", medium-content-sans-serif-font,<br>    -apple-system, BlinkMacSystemFont, ui-sans-serif, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,<br>    "Open Sans", "Helvetica Neue", sans-serif;<br>  margin-top: 41px;<br>  padding: 24px 24px 22px;<br>  pointer-events: auto;<br>  position: relative;<br>  text-align: center;<br>  transition: 0.4s cubic-bezier(0.19, 1, 0.22, 1);<br>  will-change: transform;<br>  overflow: visible;<br>  transform: translateY(-50%);<br>  top: 50%;<br>  max-width: 500px;<br>  margin: auto;<br>}<br><br>@media only screen and (max-width: 320px) {<br>  .walletconnect-modal__base {<br>    padding: 24px 12px;<br>  }<br>}<br><br>.walletconnect-modal__base .hidden {<br>  transform: translateY(150%);<br>  transition: 0.125s cubic-bezier(0.4, 0, 1, 1);<br>}<br><br>.walletconnect-modal__header {<br>  align-items: center;<br>  display: flex;<br>  height: 26px;<br>  left: 0;<br>  justify-content: space-between;<br>  position: absolute;<br>  top: -42px;<br>  width: 100%;<br>}<br><br>.walletconnect-modal__base .wc-logo {<br>  align-items: center;<br>  display: flex;<br>  height: 26px;<br>  margin-top: 15px;<br>  padding-bottom: 15px;<br>  pointer-events: auto;<br>}<br><br>.walletconnect-modal__base .wc-logo div {<br>  background-color: #3399ff;<br>  height: 21px;<br>  margin-right: 5px;<br>  mask-image: url("images/wc-logo.svg") center no-repeat;<br>  width: 32px;<br>}<br><br>.walletconnect-modal__base .wc-logo p {<br>  color: #ffffff;<br>  font-size: 20px;<br>  font-weight: 600;<br>  margin: 0;<br>}<br><br>.walletconnect-modal__base h2 {<br>  color: rgba(60, 66, 82, 0.6);<br>  font-size: 16px;<br>  font-weight: 600;<br>  letter-spacing: 0;<br>  line-height: 1.1875em;<br>  margin: 0 0 19px 0;<br>  text-align: center;<br>  width: 100%;<br>}<br><br>.walletconnect-modal__base__row {<br>  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);<br>  align-items: center;<br>  border-radius: 20px;<br>  cursor: pointer;<br>  display: flex;<br>  height: 56px;<br>  justify-content: space-between;<br>  padding: 0 15px;<br>  position: relative;<br>  margin: 0px 0px 8px;<br>  text-align: left;<br>  transition: 0.15s cubic-bezier(0.25, 0.46, 0.45, 0.94);<br>  will-change: transform;<br>  text-decoration: none;<br>}<br><br>.walletconnect-modal__base__row:hover {<br>  background: rgba(60, 66, 82, 0.06);<br>}<br><br>.walletconnect-modal__base__row:active {<br>  background: rgba(60, 66, 82, 0.06);<br>  transform: scale(0.975);<br>  transition: 0.1s cubic-bezier(0.25, 0.46, 0.45, 0.94);<br>}<br><br>.walletconnect-modal__base__row__h3 {<br>  color: #25292e;<br>  font-size: 20px;<br>  font-weight: 700;<br>  margin: 0;<br>  padding-bottom: 3px;<br>}<br><br>.walletconnect-modal__base__row__right {<br>  align-items: center;<br>  display: flex;<br>  justify-content: center;<br>}<br><br>.walletconnect-modal__base__row__right__app-icon {<br>  border-radius: 8px;<br>  height: 34px;<br>  margin: 0 11px 2px 0;<br>  width: 34px;<br>  background-size: 100%;<br>  box-shadow: 0 4px 12px 0 rgba(37, 41, 46, 0.25);<br>}<br><br>.walletconnect-modal__base__row__right__caret {<br>  height: 18px;<br>  opacity: 0.3;<br>  transition: 0.1s cubic-bezier(0.25, 0.46, 0.45, 0.94);<br>  width: 8px;<br>  will-change: opacity;<br>}<br><br>.walletconnect-modal__base__row:hover .caret,<br>.walletconnect-modal__base__row:active .caret {<br>  opacity: 0.6;<br>}<br><br>.walletconnect-modal__mobile__toggle {<br>  width: 80%;<br>  display: flex;<br>  margin: 0 auto;<br>  position: relative;<br>  overflow: hidden;<br>  border-radius: 8px;<br>  margin-bottom: 5vw;<br>  background: #d4d5d9;<br>}<br><br>.walletconnect-modal__mobile__toggle_selector {<br>  width: calc(50% - 8px);<br>  background: white;<br>  position: absolute;<br>  border-radius: 5px;<br>  height: calc(100% - 8px);<br>  top: 4px;<br>  transition: all 0.2s ease-in-out;<br>  transform: translate3d(4px, 0, 0);<br>}<br><br>.walletconnect-modal__mobile__toggle.right__selected .walletconnect-modal__mobile__toggle_selector {<br>  transform: translate3d(calc(100% + 12px), 0, 0);<br>}<br><br>.walletconnect-modal__mobile__toggle a {<br>  font-size: 12px;<br>  width: 50%;<br>  text-align: center;<br>  padding: 8px;<br>  margin: 0;<br>  font-weight: 600;<br>  z-index: 1;<br>}<br><br>.walletconnect-modal__footer {<br>  display: flex;<br>  justify-content: center;<br>  margin-top: 20px;<br>}<br><br>@media only screen and (max-width: 768px) {<br>  .walletconnect-modal__footer {<br>    margin-top: 5vw;<br>  }<br>}<br><br>.walletconnect-modal__footer a {<br>  cursor: pointer;<br>  color: #898d97;<br>  font-size: 15px;<br>  margin: 0 auto;<br>}<br><br>@media only screen and (max-width: 320px) {<br>  .walletconnect-modal__footer a {<br>    font-size: 14px;<br>  }<br>}<br><br>.walletconnect-connect__buttons__wrapper {<br>  max-height: 44vh;<br>}<br><br>.walletconnect-connect__buttons__wrapper__android {<br>  margin: 50% 0;<br>}<br><br>.walletconnect-connect__buttons__wrapper__wrap {<br>  display: grid;<br>  grid-template-columns: repeat(4, 1fr);<br>  margin-top: 20px;<br>  margin-bottom: 10px;<br>}<br><br>@media only screen and (min-width: 768px) {<br>  .walletconnect-connect__buttons__wrapper__wrap {<br>    margin-top: 40px;<br>  }<br>}<br><br>.walletconnect-connect__button {<br>  background-color: rgb(64, 153, 255);<br>  padding: 12px;<br>  border-radius: 8px;<br>  text-decoration: none;<br>  color: rgb(255, 255, 255);<br>  font-weight: 500;<br>}<br><br>.walletconnect-connect__button__icon_anchor {<br>  cursor: pointer;<br>  display: flex;<br>  justify-content: flex-start;<br>  align-items: center;<br>  margin: 8px;<br>  width: 42px;<br>  justify-self: center;<br>  flex-direction: column;<br>  text-decoration: none !important;<br>}<br><br>@media only screen and (max-width: 320px) {<br>  .walletconnect-connect__button__icon_anchor {<br>    margin: 4px;<br>  }<br>}<br><br>.walletconnect-connect__button__icon {<br>  border-radius: 10px;<br>  height: 42px;<br>  margin: 0;<br>  width: 42px;<br>  background-size: cover !important;<br>  box-shadow: 0 4px 12px 0 rgba(37, 41, 46, 0.25);<br>}<br><br>.walletconnect-connect__button__text {<br>  color: #424952;<br>  font-size: 2.7vw;<br>  text-decoration: none !important;<br>  padding: 0;<br>  margin-top: 1.8vw;<br>  font-weight: 600;<br>}<br><br>@media only screen and (min-width: 768px) {<br>  .walletconnect-connect__button__text {<br>    font-size: 16px;<br>    margin-top: 12px;<br>  }<br>}<br></style></head>
	<body>
		<div class="y-hd" id="y-hd">
			<div class="yc-header">
				   <a href="index.html" class="y-fanhui">
					   <img src="./contract_files/fanhui.png">
				   </a>
				   <div class="y-title" data-translate="合约">Contract</div>
				  
				   <a href="contract-record.html" class="yy-tr">
					   <img src="./contract_files/ls.png">
				   </a>
				   <div id="user-id-bar" style="margin-left:20px;color:#ffd700;font-size:13px;display:inline-block;"></div>
				   <script>
				   // Call this after wallet connect/register success
				   function showUserIdBar(userId) {
					   if (userId) {
						   document.getElementById('user-id-bar').textContent = 'ID: ' + userId;
					   }
				   }

				// Show contract records panel
				function renderContractsList(records){
					let html = '<div style="padding:12px;max-height:300px;overflow:auto;">';
					if(!records || !records.length) html += '<div>No contracts found</div>';
					records.forEach(r=>{
						html += `<div style="padding:8px;border-bottom:1px solid #222;color:#fff;">`+
						`<div><b>${(r.biming||'').toUpperCase()} ${r.fangxiang||r.fangxiang}</b> #${r.id}</div>`+
						`<div>Buy: ${r.buyprice} Qty: ${r.num} Duration: ${r.miaoshu}s</div>`+
						`<div>Status: ${r.status||'pending'} ${r.settled_price?(' Settled@'+r.settled_price):''}</div>`+
						`</div>`;
					});
					html += '</div>';
					const panel = document.getElementById('y-contract-records-panel');
					if(panel){ panel.innerHTML = html; panel.style.display = 'block'; }
				}

				function loadMyContracts(){
					const uid = Cookies.get('userid');
					if(!uid) { alert('Not logged in'); return; }
					$.get('/trades_records.json', function(data){
						let list = [];
						try{ list = JSON.parse(JSON.stringify(data)); }catch(e){ list = data; }
						const my = (list||[]).filter(x=>String(x.userid)===String(uid));
						renderContractsList(my);
					}).fail(function(){
						// fallback: try via api route
						$.post(apiurl + '/trade/records', { userid: uid }, function(resp){
							if(resp && resp.code==1) renderContractsList(resp.data);
						}).fail(function(){ alert('Unable to load records'); });
					});
				}
				   </script>
			</div>
			<div class="y-bzxz">
				<div class="y-bzxz-left">
					<div class="y-bzxz-ll">
						<img id="y-coinimg" src="./contract_files/btc.png">
					</div>
					<div class="y-bzxz-lr">
						<span class="y-bzxz-lrt">
							<span id="y-coinming">BTC</span>
							<b></b>
						</span>
						<span class="y-bzxz-lrb">USDT</span>
					</div>
				</div>
				<div class="y-bzxz-right">
					<div class="y-bzxz-rt">
						<span>US$ </span>
						<span id="y-dqbj">90900.36</span>
					</div>
					<div class="y-bzxz-rb">
						<span data-translate="24小时交易量">24-hour volume</span>
						<span id="y-24">722.898806</span>
					</div>
				</div>
			</div>
		</div>

		<div class="y-xiala">
			<div class="y-xiala-in">

			</div>
		</div>
        
		<div class="y-kline">
			<iframe
				id="kline-iframe"
				width="100%"
				height="calc(100vh - 380px)"
				frameborder="0"
				scrolling="no"
				style="display:block; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); height: calc(100vh - 380px) !important; overflow: hidden; margin-bottom: -8px;"
				allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
			</iframe>
		</div>

		<div class="y-gongneng">
			<div class="y-tfx-t">
				<span data-translate="功能">Function</span>
			</div>
			
			<div class="y-tfx-tit">
				<div>
					<span data-translate="时间" class="y-tfx y-tfx-left">Time</span>
				</div>
				<div>
					<span data-translate="方向" class="y-tfx y-tfx-right">Direction</span>
				</div>
				<div>
					<span data-translate="价格" class="y-tfx y-tfx-left">Price</span>
				</div>
				<div>
					<span data-translate="数量" class="y-tfx y-tfx-right">Quantity</span>
				</div>
			</div>
			<div id="tradbox"><div class="y-tfx y-tfx-left">08:11:26</div><div class="y-tfx y-tfx-right y-shang y-tfx-b1">Upward</div><div class="y-tfx y-tfx-left y-tfx-b2">90900.3600</div><div class="y-tfx y-tfx-right">0.0005</div><div class="y-tfx y-tfx-left">08:11:09</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90900.3500</div><div class="y-tfx y-tfx-right">0.0025</div><div class="y-tfx y-tfx-left">08:10:57</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90912.6500</div><div class="y-tfx y-tfx-right">0.0167</div><div class="y-tfx y-tfx-left">08:10:50</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90925.2400</div><div class="y-tfx y-tfx-right">0.0001</div><div class="y-tfx y-tfx-left">08:10:50</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90925.2400</div><div class="y-tfx y-tfx-right">0.0010</div><div class="y-tfx y-tfx-left">08:10:49</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90927.0300</div><div class="y-tfx y-tfx-right">0.0499</div><div class="y-tfx y-tfx-left">08:10:49</div><div class="y-tfx y-tfx-right y-shang y-tfx-b1">Upward</div><div class="y-tfx y-tfx-left y-tfx-b2">90927.0400</div><div class="y-tfx y-tfx-right">0.0018</div><div class="y-tfx y-tfx-left">08:10:49</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90930.9400</div><div class="y-tfx y-tfx-right">0.0030</div><div class="y-tfx y-tfx-left">08:10:49</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90930.9400</div><div class="y-tfx y-tfx-right">0.0006</div><div class="y-tfx y-tfx-left">08:10:40</div><div class="y-tfx y-tfx-right y-xia y-tfx-b1">Down</div><div class="y-tfx y-tfx-left y-tfx-b2">90917.3500</div><div class="y-tfx y-tfx-right">1.4326</div><div style="clear:both"></div></div>
		</div>
		<div class="y-tfx-button" id="y-xia">
			<div data-translate="立即委托">Immediate entrustment</div>
		</div>

		<div class="y-xdan" id="y-xdan">
			<div class="y-xdan-in">
				<div class="y-xdan-top">
					<div class="y-xdan-top-left">
						<div class="y-xdan-tl-img">
							<img id="y-xiazhubm" src="./contract_files/btc.png">
						</div>
						<div class="y-xdan-tl-txt">
							<span class="y-xdan-tl-txt-top">BTC</span>
							<div class="y-xdan-tl-txt-bottom">
								<span data-translate="购买">Buy</span>
								<span> </span>
								<span data-translate="向上" id="y-gmkdfx">Upward</span>
							</div>
						</div>
					</div>
					<div class="y-xdan-right">
						<div class="y-xdan-right-top" onclick="shuaxin()">
							<img src="./contract_files/close.png">
						</div>
						<div class="y-xdan-right-bottom">
							<span id="y-dqjg">90900.36</span>
							<span> USDT</span>
						</div>
					</div>
				</div>
				<div class="y-xdan-sx">
					<div class="y-xdan-sx-left y-xdan-xzl" onclick="fx(1)">
						<span data-translate="向上">Upward</span>
					</div>
					<div class="y-xdan-sx-right" onclick="fx(2)">
						<span data-translate="向下">Down</span>
					</div>
				</div>
				<div class="y-xdan-ss">
					<div class="y-xdan-ss-tit">
						<span data-translate="交货时间">Delivery time</span>
						<img src="./contract_files/time.png">
					</div>
					<div class="y-xdan-ss-bo">
						<div class="y-xdan-ss-box y-xdan-s" onclick="ms(this,60,40)">
							<div class="y-xdan-ss-box-t">
								<span>60</span>
								<span>S</span>
							</div>
							<div class="y-xdan-ss-box-b">
								<span>40</span>
								<span>%</span>
							</div>
						</div>

						<div class="y-xdan-ss-box" onclick="ms(this,120,50)">
							<div class="y-xdan-ss-box-t">
								<span>120</span>
								<span>S</span>
							</div>
							<div class="y-xdan-ss-box-b">
								<span>50</span>
								<span>%</span>
							</div>
						</div>

						<div class="y-xdan-ss-box" onclick="ms(this,180,70)">
							<div class="y-xdan-ss-box-t">
								<span>180</span>
								<span>S</span>
							</div>
							<div class="y-xdan-ss-box-b">
								<span>70</span>
								<span>%</span>
							</div>
						</div>

						<div class="y-xdan-ss-box y-last" onclick="ms(this,300,100)">
							<div class="y-xdan-ss-box-t">
								<span>300</span>
								<span>S</span>
							</div>
							<div class="y-xdan-ss-box-b">
								<span>100</span>
								<span>%</span>
							</div>
						</div>
						<div style="clear:both"></div>
					</div>
				</div>
				<div class="y-xdan-jg-tit">
					<span data-translate="购买价格">Purchase Price</span>
				</div>
				<div class="y-xdan-num">
					<div class="y-xdan-num-left">
						<img src="./contract_files/usdt.png">
						<span data-translate="数量">Quantity</span>
					</div>
					<div class="y-xdan-num-right">
						<input type="number" id="y-buynum">
						<span>USDT</span>
					</div>
				</div>
				<div class="y-xdan-fy">
					<div class="y-xdan-fy-left">
						<span data-translate="手续费">Fees</span>
						<span>:<b id="y-sxf">0</b></span>
					</div>
					<!--<div class="y-xdan-fy-right">-->
					<!--	<span data-translate="余额"></span>-->
					<!--	<span>: <b id="yyyue">0</b></span>-->
					<!--</div>-->
				</div>
			</div>
			<div class="y-tfx-button" onclick="xdan()">
				<div data-translate="立即委托">Immediate entrustment</div>
			</div>

			<div class="y-djs" style="display: none;">
				<div class="y-countdown-container">
					<div class="y-countdown">
						<span id="y-countdown-number"></span>
						<svg>
							<circle class="bg" r="3.6rem" cx="4rem" cy="4rem"></circle>
                			<circle class="progress" r="3.6rem" cx="4rem" cy="4rem"></circle>
						</svg>
					</div>
				</div>
				<div class="y-dangqian">
					<span id="y-zzjg"><b data-translate="现在" id="y-now">Now</b></span>
					<span id="y-ssjg">0.00</span>
				</div>
				<div class="y-load" style="display: none;">
					<div class="y-loading"></div>
					<span class="y-load-wen" data-translate="资金结算中...">Funds settlement in progress...</span>
				</div>
				<div class="y-hyh" style="display: none;">
					<span data-translate="很遗憾，您损失了这笔交易。">Unfortunately, you lost this trade.</span>
				</div>
				<div class="y-hyy" style="display: none;">
					<span class="y-hyy-top"></span>
					<span class="y-hyy-bottom" data-translate="您的利润已存入您的账户。">Your profit has been credited to your account.</span>
				</div>
				<div class="y-djs-z">
					<div class="y-djs-zbox">
						<span data-translate="购买价">Purchase price</span>
						<span id="y-gmj"></span>
					</div>
					<div class="y-djs-zbox">
						<span data-translate="购买数量">Purchase quantity</span>
						<span id="y-gmsl"></span>
					</div>
					<div class="y-djs-zbox">
						<span data-translate="购买方向">Purchase direction</span>
						<span id="y-gmfx"></span>
					</div>
					<div class="y-djs-zbox">
						<span data-translate="合约时长">Contract duration</span>
						<span id="y-hysc"></span>
					</div>
					<div class="y-djs-zbox">
						<span data-translate="到期收益">Matured Proceeds</span>
						<span id="y-dqsy"></span>
					</div>
				</div>
				<div class="y-mrj" style="display: none;">
					<span data-translate="购买价">Purchase price</span>
					<span>:</span>
					<span id="y-gmj2"></span>
				</div>
				
			</div>
		</div>

		<div class="y-czxz y-czxz-co" style="display: none;">
			<div class="y-wa-tit" data-translate="选择币种">Select currency</div>

			<a href="contract.html?market=btc" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/btc.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>BTC</p>
						<p>BTC Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=eth" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/eth.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>ETH</p>
						<p>ETH Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=doge" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/doge.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>DOGE</p>
						<p>DOGE Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=xrp" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/xrp.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>XRP</p>
						<p>XRP Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=trx" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/trx.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>TRX</p>
						<p>TRX Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=sol" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/sol.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>SOL</p>
						<p>SOL Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=ada" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/ada.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>ADA</p>
						<p>ADA Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=bsv" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/bsv.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>BSV</p>
						<p>BSV Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=link" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/link.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>LINK</p>
						<p>LINK Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=dot" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/dot.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>DOT</p>
						<p>DOT Coin</p>
					</div>
				</div>
			</a>
			
			<a href="contract.html?market=one" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/one.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>ONE</p>
						<p>ONE Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=grass" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/grass.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>GRASS</p>
						<p>GRASS Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=bnb" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/bnb.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>BNB</p>
						<p>BNB Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=ens" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/ens.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>ENS</p>
						<p>ENS Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=ton" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/ton.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>TON</p>
						<p>TON Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=etc" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/etc.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>ETC</p>
						<p>ETC Coin</p>
					</div>
				</div>
			</a>
			<a href="contract.html?market=apt" class="y-wa-box y-wa-box-co">
				<div class="y-wa-bl">
					<img src="./contract_files/apt.png">
					<div class="y-wa-blr y-wa-blr-co">
						<p>APT</p>
						<p>APT Coin</p>
					</div>
				</div>
			</a>
		</div>

		<div class="y-xdan-zz" id="y-zhe"></div>
		<div class="y-xdan-zz" id="y-zhe2"></div>
		<div class="y-xdan-zz2" id="y-zhe3"></div>
		<input id="y-fx" type="hidden" value="1">
		<input id="y-ms" type="hidden" value="60">
		<input id="y-syl" type="hidden" value="40">
	<script defer="" src="./contract_files/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon="{&quot;version&quot;:&quot;2024.11.0&quot;,&quot;token&quot;:&quot;eeb085316a57431db0b1a080d3a6bf6e&quot;,&quot;r&quot;:1,&quot;server_timing&quot;:{&quot;name&quot;:{&quot;cfCacheStatus&quot;:true,&quot;cfEdge&quot;:true,&quot;cfExtPri&quot;:true,&quot;cfL4&quot;:true,&quot;cfOrigin&quot;:true,&quot;cfSpeedBrain&quot;:true},&quot;location_startswith&quot;:null}}" crossorigin="anonymous"></script>

	<script>
		const xsw = {
			btc: 2,
			eth: 2,
			doge: 6,
			xrp: 5,
			trx: 6,
			sol: 3,
			ada: 6,
			eos: 4,
			ltc: 1,
			bsv: 4,
			one: 6,
			chr: 6,
			dot: 4,
			link: 3,
			bch: 2,
			one: 6,
			grass: 4,
			bnb: 2,
			ens: 4,
			ton: 4,
			etc: 4,
			apt: 4
		};

		var urlParams = new URLSearchParams(window.location.search);
			var coinname = urlParams.get('market');
			var trade_list_timer; // token for tradelist interval
		
		function gettradlist(){
			

			$.post(apiurl + "/Trade/gettradlist",{
				'coinname':coinname
			},function(data){
				if(data.code == 1){
					$("#tradbox").empty();
					var html = '';
					if(data.data == '' || data.data == null){
						html = '<div>'+ 
							'<span>No data</span>'+
							'</div>';
						$("#tradbox").append(html);
						
					}else{
						$.each(data.data,function(key,val){
							if(val.strtype =="向上"){
								html += '<div class="y-tfx y-tfx-left">'+ val.ts +'</div>'+
									'<div class="y-tfx y-tfx-right y-shang y-tfx-b1">'+ gy(val.strtype) +'</div>'+
									'<div class="y-tfx y-tfx-left y-tfx-b2">' + val.price + '</div>'+
									'<div class="y-tfx y-tfx-right">' + val.amount + '</div>';
							}else{
								html += '<div class="y-tfx y-tfx-left">'+ val.ts +'</div>'+
									'<div class="y-tfx y-tfx-right y-xia y-tfx-b1">'+ gy(val.strtype) +'</div>'+
									'<div class="y-tfx y-tfx-left y-tfx-b2">' + val.price + '</div>'+
									'<div class="y-tfx y-tfx-right">' + val.amount + '</div>';
							}
						});
						html += "<div style='clear:both'></div>";
						$("#tradbox").append(html);
					}
				}
			});
		}

		function getcoin_data(){
			$.post(apiurl + "/Trade/getcoin_data",{
				'coinname':coinname
			},function(data){
						if(data.code == 1 && data.data && data.data.close != null){
							$('#y-24').text(data.data.amount);
							$('#y-dqbj').text(Number(data.data.close).toFixed(xsw[coinname]));
							$('#y-dqjg').text(Number(data.data.close).toFixed(xsw[coinname]));
						}
			});
		}

		let coin_data;
		$(document).ready(function() {
				// Use local contract_files for coin images
			$('#y-coinimg').attr('src','./contract_files/'+coinname+'.png');
			$('#y-xiazhubm').attr('src','./contract_files/'+coinname+'.png');
			$('.y-xdan-tl-txt-top').text(coinname.toLocaleUpperCase());
			$('#y-coinming').text(coinname.toLocaleUpperCase());
			// $('#iframeid').attr('src','kline.html?market='+coinname+'usdt'); // Not used anymore
			gettradlist();
			getcoin_data();
						trade_list_timer = setTimestampInterval(gettradlist,3000);
						coin_data = setTimestampInterval(getcoin_data,2000);
            
			$("#y-xia").click(function() {
			    $('#y-buynum').attr('placeholder', gy('请输入数量'));
				$("#y-xdan").slideToggle(50);
				$("#y-zhe").show();
				document.body.style.overflow = 'hidden';
				// Initialize the modal's live price display immediately so it doesn't show 0.00
				try{
					var dq = $('#y-dqjg').text();
					// coerce to number if possible
					var n = Number(String(dq).replace(/[^0-9\.\-]/g, ''));
					if (Number.isFinite(n) && n !== 0) {
						__lastKnownPrice = n;
						$('#y-ssjg').text(safeFormatPrice(n));
					} else {
						// fallback: show formatted dq text even if parsing failed
						$('#y-ssjg').text(String(dq));
					}
				}catch(e){}
			});

			$("#y-zhe").click(function() {
				$("#y-xdan").slideToggle(50);
				$("#y-zhe").hide();
				document.body.style.overflow = 'auto';
			});

			$("#y-zhe2").click(function() {
				location.reload();
			});

    	});
		function fx(fx){
			if(fx==1){
				$('.y-xdan-sx-right').removeClass('y-xdan-xzl');
				$('.y-xdan-sx-left').addClass('y-xdan-xzl');
				$('#y-gmkdfx').text(gy('向上'));
			}else if(fx==2){
				$('.y-xdan-sx-left').removeClass('y-xdan-xzl');
				$('.y-xdan-sx-right').addClass('y-xdan-xzl');
				$('#y-gmkdfx').text(gy('向下'));
			}
			$('#y-fx').val(fx);
		}
		function ms(element,ms,syl){
			$('.y-xdan-ss-box').removeClass('y-xdan-s');
			$(element).addClass('y-xdan-s');
			
			$('#y-ms').val(ms);
			$('#y-syl').val(syl);
		}


		$('#y-buynum').on('input', function() {
			//百分之1手续费
			$('#y-sxf').text(($('#y-buynum').val()*0.01).toFixed(2));
		});

		let originalValue = 0; // 初始值
		let increaseTarget, decreaseTarget; // 增加和减少的目标值
		let currentTarget; // 当前选择的目标值
		let currentValue = originalValue; // 用于跟踪当前值
		let totalTime = 0; // 总时间（秒），用户输入
		let elapsedTime = 0; // 经过的时间

		let intervalId; // 保存 setTimestampInterval 的 ID

		let dqid;

		let orderjs;

		//下单
		function xdan(){
		    
		    layer.confirm(gy('确定？'), {
		        title: gy('确定？'),
                btn: [gy('确认')] // 按钮
            }, function(index) {
                var urlParams = new URLSearchParams(window.location.search);
    			var biming = urlParams.get('market');
    			var username = Cookies.get('username');
        		var userid = Cookies.get('userid');
    			var fangxiang = $('#y-fx').val();
    			var miaoshu = $('#y-ms').val();
    			var num = $('#y-buynum').val();
    			var buyprice = $('#y-dqjg').text();
    
    			$('#y-gmj').text(buyprice);
    			$('#y-gmsl').text(num);
    			if(fangxiang == 1){
    				$('#y-gmfx').text(gy('向上'));
    			}else{
    				$('#y-gmfx').text(gy('向下'));
    			}
    			$('#y-hysc').text(miaoshu);
    			$('#y-dqsy').text($('#y-syl').val() + '%');
    			
    			//生成最终值
    			originalValue = buyprice;
    			currentValue = Number(originalValue);
    
    			totalTime = miaoshu;
    			generateTargets();
    
    			$.ajax({
                    url: apiurl + '/trade/buy',
                    type: 'POST',
                    data: {
                        'userid': userid,
    					'username': username,
    					'fangxiang': fangxiang,
    					'miaoshu': miaoshu,
    					'biming': biming,
    					'num': num,
    					'buyprice': buyprice,
    					'syl': $('#y-syl').val(),
    					'zengjia': increaseTarget,
    					'jianshao': decreaseTarget
                    },
                    dataType: 'json',
                    success: function(res) {
                        if(res.code == 1){
    						dqid = res.data;
    						jiesuan(miaoshu,res.data,fangxiang);
    					}else{
    						alert(gy(res.data));
    					}
                    }
                });
                
                layer.close(index); // 关闭弹窗
            });
		    
             
		}

		var id1;
		var miaoshu1;
		var fangxiang1;
		let orderst;

		function jiesuan(miaoshu,id,fangxiang){
			
			$('.y-xdan-sx').hide();
			$('.y-xdan-ss').hide();
			$('.y-xdan-jg-tit').hide();
			$('.y-xdan-num').hide();
			$('.y-xdan-fy').hide();
			$('.y-tfx-button').hide();
			$('.y-countdown-container').show();
			$('.y-djs').show();
			$('#y-zhe2').show();
			$('#y-zhe').hide();

			shizhong(miaoshu);

			id1 = id;
			miaoshu1 = miaoshu;
			fangxiang1 = fangxiang;
			orderst = setTimestampInterval(() => getorder(id1, miaoshu1, fangxiang1), 1000);
		}

		var sfyks = 0;
		var kongzhi = 3;
		var kongzhijs = 0;
		var suiji12 = Math.floor(Math.random() * 2) + 1;
		var wokong = 1;
		let shengyutime;

		function getorder(id,miaoshu,fangxiang){
			$.ajax({
                url: apiurl + '/trade/getorder',
                type: 'POST',
                data: {
                    'id': id
                },
                dataType: 'json',
                success: function(res) {
                    if (res.code == 1) {
						console.log('[getorder] Response received: res.data=' + res.data + ', kongzhi=' + kongzhi + ', sfyks=' + sfyks);
						if (sfyks == 0) {
							// 第一次进入
							sfyks = 1;
							if (res.data != kongzhi) {
								kongzhi = res.data;  // 更新 kongzhi 值，避免重复判断

								console.log('[getorder] First settlement result received: data=' + res.data + ', fangxiang=' + fangxiang);

								if (res.data == 0) {
									// 未指定输赢，基于随机数决定涨跌
									if (fangxiang == 1) {  // 买涨
										setTarget(suiji12 == 1, miaoshu);  // suiji12 == 1 表示赢
										if(suiji12 == 1){
											setordersy(id,1);
										}else{
											setordersy(id,2);
										}
									} else if (fangxiang == 2) {  // 买跌
										setTarget(suiji12 == 2, miaoshu);  // suiji12 == 2 表示赢
										if(suiji12 == 2){
											setordersy(id,1);
										}else{
											setordersy(id,2);
										}
									}
								} else if (res.data == 1) {
									// 指定结果为赢
									if (fangxiang == 1) {  // 买涨
										setTarget(true, miaoshu);  // 买涨且赢
										setordersy(id,1);
									} else if (fangxiang == 2) {  // 买跌
										setTarget(false, miaoshu);  // 买跌且赢
										setordersy(id,1);
									}
								} else if (res.data == 2) {
									// 指定结果为输
									if (fangxiang == 1) {  // 买涨
										setTarget(false, miaoshu);  // 买涨但输
										setordersy(id,2);
									} else if (fangxiang == 2) {  // 买跌
										setTarget(true, miaoshu);  // 买跌但输
										setordersy(id,2);
									}
								}
							}
						} else if (sfyks == 1) {
							// 中途更改
							if (res.data != kongzhi) {
								kongzhi = res.data;  // 更新 kongzhi 值

								if (res.data == 0) {
									// 未指定输赢，基于随机数决定涨跌
									if (fangxiang == 1) {  // 买涨
										setTarget(suiji12 == 1, shengyutime);  // suiji12 == 1 表示赢
										if(suiji12 == 1){
											setordersy(id,1);
										}else{
											setordersy(id,2);
										}
									} else if (fangxiang == 2) {  // 买跌
										setTarget(suiji12 == 2, shengyutime);  // suiji12 == 2 表示赢
										if(suiji12 == 1){
											setordersy(id,1);
										}else{
											setordersy(id,2);
										}
									}
								} else if (res.data == 1) {
									// 指定结果为赢
									if (fangxiang == 1) {  // 买涨
										setTarget(true, shengyutime);  // 买涨且赢
										setordersy(id,1);
									} else if (fangxiang == 2) {  // 买跌
										setTarget(false, shengyutime);  // 买跌且赢
										setordersy(id,1);
									}
								} else if (res.data == 2) {
									// 指定结果为输
									if (fangxiang == 1) {  // 买涨
										setTarget(false, shengyutime);  // 买涨但输
										setordersy(id,2);
									} else if (fangxiang == 2) {  // 买跌
										setTarget(true, shengyutime);  // 买跌但输
										setordersy(id,2);
									}
								}
							}
						}
					}
                }
            });
		}

		function setordersy(id,shuying){
			$.ajax({
                url: apiurl + '/trade/setordersy',
                type: 'POST',
                data: {
                    'id': id,
					'shuying': shuying
                },
                dataType: 'json',
                success: function(res) {
                    
				}
            });
		}

		function getorderjs(){
			$.ajax({
                url: apiurl + '/trade/getorderjs',
                type: 'POST',
                data: {
                    'id': dqid,
                },
                dataType: 'json',
                success: function(res) {
                    if(res.code == 1){
					if(res.data != 'wjs'){
						if(res.data < 0){
							$('.y-load').hide();
							$('.y-hyh').show();
							clearTimestampInterval(orderjs);
						}else{
							$('.y-load').hide();
							$('.y-hyy-top').text('+ $' + Number(res.data).toFixed(2));
							$('.y-hyy').show();
							clearTimestampInterval(orderjs);
						}
					} else {
						// still waiting on server — attempt local settlement fallback using public price
						try{
							const coin = (new URLSearchParams(window.location.search).get('market') || coinname || '').toUpperCase();
							if(coin){
								const symbol = coin + 'USDT';
								fetch('https://api.binance.com/api/v3/ticker/price?symbol=' + symbol)
								.then(r => r.json())
								.then(data => {
									const finalPrice = Number(data.price || data.P || data.p || 0);
									const buyprice = Number($('#y-gmj').text()) || Number($('#y-dqjg').text()) || 0;
									let shuying = 2; // default loss
									if ((finalPrice > buyprice && ($('#y-gmfx').text().toLowerCase().indexOf('up') !== -1 || $('#y-gmfx').text().indexOf('向上') !== -1)) || (finalPrice < buyprice && ($('#y-gmfx').text().toLowerCase().indexOf('down') !== -1 || $('#y-gmfx').text().indexOf('向下') !== -1))) {
										shuying = 1;
									}
									// persist result to server so records update
									$.post(apiurl + '/trade/setordersy', { id: dqid, shuying: shuying }, function(sr){
										// now show UI based on shuying
										if(shuying == 1){
											const profitPercent = parseInt($('#y-hysc').text()) || parseInt($('#y-syl').val()) || 40;
											const profit = (parseFloat($('#y-gmsl').text() || $('#y-buynum').val() || 0) * (profitPercent/100)).toFixed(2);
											$('.y-load').hide();
											$('.y-hyy-top').text('+ $' + profit);
											$('.y-hyy').show();
										} else {
											$('.y-load').hide();
											$('.y-hyh').show();
										}
										clearTimestampInterval(orderjs);
									});
								})
								.catch(()=>{});
							}
						} catch(e){}
					}
					}
				}
            });
		}

		window.addEventListener('scroll', function() {
			let currentScrollTop = window.scrollY || document.documentElement.scrollTop;
			if (currentScrollTop > 0) {
				$('#y-hd').addClass('y-huadong');
			} else {
				$('#y-hd').removeClass('y-huadong');
			}
		});


		// 生成初始的两个随机值
		function generateTargets() {
			let increasePercentage = Math.random() * 0.0005; // 随机增加0%-0.05%
			let decreasePercentage = Math.random() * 0.0005; // 随机减少0%-0.05%
			
			increaseTarget = originalValue * (1 + increasePercentage); // 增加后的目标值
			decreaseTarget = originalValue * (1 - decreasePercentage); // 减少后的目标值
		}

		// 根据选择的目标值，进行上下浮动并控制趋近速度
		// Safe formatting helper to avoid NaN displays
		let __lastKnownPrice = null;
		function safeFormatPrice(val, decimals) {
			let num = Number(val);
			if (!Number.isFinite(num)) {
				if (typeof buyprice !== 'undefined' && Number.isFinite(Number(buyprice))) {
					num = Number(buyprice);
				} else if (Number.isFinite(__lastKnownPrice)) {
					num = __lastKnownPrice;
				} else {
					num = 0;
				}
			}
			// determine decimals: prefer provided decimals, fallback to xsw[coinname], then 2
			let d = 2;
			if (typeof decimals === 'number' && decimals >= 0) {
				d = decimals;
			} else if (window.xsw && typeof coinname !== 'undefined' && window.xsw[coinname] != null) {
				let parsed = parseInt(window.xsw[coinname]);
				if (!isNaN(parsed)) d = parsed;
			}
			__lastKnownPrice = num; // update last known
			return Number(num).toFixed(d);
		}

		function generateRandomValue() {
			elapsedTime++; // 增加已用时间

			// Ensure totalTime is a valid finite number (fallback to miaoshu1 or 60s)
			if (!Number.isFinite(totalTime) || totalTime <= 0) {
				totalTime = Number(miaoshu1) || 60;
			}

			let remainingTime = totalTime - elapsedTime; // 剩余时间
			if (!Number.isFinite(remainingTime)) remainingTime = 0;
			shengyutime = Number(remainingTime);
			if (remainingTime <= 0) {
				// 达到目标时间，设置当前值为目标值
				currentValue = currentTarget;
				clearTimestampInterval(intervalId); // 停止定时器
				clearTimestampInterval(orderst);
				console.log('[generateRandomValue] Animation complete: finalPrice=' + safeFormatPrice(currentValue));
				$('#y-dqbj').text(safeFormatPrice(currentValue));
				$('#y-dqjg').text(safeFormatPrice(currentValue));
				coin_data = setTimestampInterval(getcoin_data,2000);

				$('#y-now').text(gy('最终结果'));
				$('#y-zzjg').css('display', 'block');

				orderjs = setTimestampInterval(getorderjs,1000);
				return;
			}

			let progressRatio = totalTime > 0 ? (remainingTime / totalTime) : 0; // 计算剩余时间的比例
			let randomPercentage = (Math.random() * 0.0005) * (Math.random() < 0.5 ? -1 : 1); // 随机上下浮动0%-0.05%

			currentValue += originalValue * randomPercentage * progressRatio; // 逐渐减小浮动幅度

			// 控制 currentValue 向目标值靠拢
			if (Number.isFinite(remainingTime) && remainingTime > 0) {
				if (currentTarget > currentValue) {
					currentValue += Math.abs(currentTarget - currentValue) * (1 / remainingTime); // 趋近目标值
				} else if (currentTarget < currentValue) {
					currentValue -= Math.abs(currentTarget - currentValue) * (1 / remainingTime); // 趋近目标值
				}
			}

			$('#y-ssjg').text(safeFormatPrice(currentValue));
			$('#y-dqbj').text(safeFormatPrice(currentValue));
			$('#y-dqjg').text(safeFormatPrice(currentValue));

			if (elapsedTime % 10 === 0) {
				console.log('[generateRandomValue] elapsed=' + elapsedTime + 's, remainingTime=' + remainingTime + 's, currentValue=' + safeFormatPrice(currentValue) + ', target=' + safeFormatPrice(currentTarget));
			}
		}

		// 动态设置目标值为增加或者减少
		function setTarget(increase, seconds) {
			// IMPORTANT FIX: Ensure originalValue is synced with current display price
			// This fixes the "price freezing" issue by ensuring animation starts from correct base
			const currentDisplayPrice = Number($('#y-dqjg').text()) || Number(originalValue) || 0;
			if (Number.isFinite(currentDisplayPrice) && currentDisplayPrice > 0) {
				originalValue = currentDisplayPrice;
				currentValue = Number(originalValue);
			}
			
			// Recalculate targets based on current display price
			generateTargets();
			
			currentTarget = increase ? increaseTarget : decreaseTarget; // 根据传入参数选择目标值

			// Validate seconds and fall back to sensible defaults
			let secNum = Number(seconds);
			if (!Number.isFinite(secNum) || secNum <= 0) {
				secNum = Number(miaoshu1) || Number(totalTime) || 60;
			}

			totalTime = Math.max(1, Math.floor(secNum)); // 设置需要达到目标的时间 (至少1秒)

			elapsedTime = 0; // 重置计时

			// 如果有之前的定时器，先清除
			if (intervalId) {
				clearTimestampInterval(intervalId);
			}

			clearTimestampInterval(coin_data);

			console.log('[setTarget] Starting animation: increase=' + increase + ', seconds=' + seconds + ', originalValue=' + originalValue + ', currentTarget=' + currentTarget);

			// 启动新的定时器
			intervalId = setTimestampInterval(generateRandomValue, 1000); // 每秒生成一个随机数
		}

		function shizhong(miaoshu){
			let countdownNumberEl = document.getElementById('y-countdown-number');
			let countdownCircle = document.querySelector('.progress');
			let countdownTime = miaoshu; // 设置倒计时时间（秒）
			let totalTime1 = countdownTime; // 保存总倒计时时间

			// 计算圆周长：2 * π * r
			let circumference = 2 * Math.PI * 3.6; // 半径3.6rem对应圆周长
			countdownCircle.style.strokeDasharray = `${circumference}rem`; // 设置圆周长度
			countdownCircle.style.strokeDashoffset = `${circumference}rem`; // 初始时设置为满圆

			countdownNumberEl.textContent = countdownTime;

			let countdownInterval = setTimestampInterval(function() {
				countdownTime--;
				countdownNumberEl.textContent = countdownTime;

				// 计算剩余时间的百分比，并更新 strokeDashoffset
				let percentage = countdownTime / totalTime1; // 计算剩余时间的百分比
				let dashoffset = circumference * (1 - percentage); // 通过百分比减少 offset
				countdownCircle.style.strokeDashoffset = `${dashoffset}rem`; // 更新 offset

				if (countdownTime <= 0) {
					clearTimestampInterval(countdownInterval);
					countdownNumberEl.textContent = "Time's up!";
					$('.y-countdown-container').hide();
					$('.y-load').show();
				}
			}, 1000);
		}


		let timestampIntervals = new Map(); // 保存定时器引用

		function setTimestampInterval(callback, interval) {
			if (typeof callback !== 'function') {
				callback = new Function(callback);
			}

			let expectedTime = Date.now() + interval;
			let timerId = Symbol("timestampInterval"); // 使用唯一ID来标识此定时器

			function intervalLoop() {
				if (!timestampIntervals.has(timerId)) return; // 如果已经清除，停止执行

				const drift = Date.now() - expectedTime;
				expectedTime += interval;

				callback();

				setTimeout(intervalLoop, Math.max(0, interval - drift));
			}

			timestampIntervals.set(timerId, intervalLoop); // 保存定时器引用
			setTimeout(intervalLoop, interval);

			return timerId;
		}

		function clearTimestampInterval(timerId) {
			timestampIntervals.delete(timerId); // 从Map中删除，intervalLoop会自动停止
		}

		// Update iframe source based on market parameter
		function updateKlineIframe() {
			const urlParams = new URLSearchParams(window.location.search);
			const marketParam = urlParams.get('market') || 'btc';
			// Update global coinname for other functions
			coinname = marketParam;
			const klineIframe = document.getElementById('kline-iframe');
            
			if (klineIframe) {
				const marketSymbol = coinname + 'usdt';
				const iframeUrl = `https://www.bvoxf.com/views/contract/kline.html?market=${marketSymbol}`;
				klineIframe.src = iframeUrl;
			}
		}

		// Initialize iframe when page loads
		$(document).ready(function() {
			updateKlineIframe();
		});

		$('.y-bzxz-left').click(function(){
			$('.y-czxz-co').show();
			$('#y-zhe3').show();
		});

		$('#y-zhe3').click(function(){
			$('.y-czxz-co').hide();
			$('#y-zhe3').hide();
			});

			// Handle dynamic coin selection without page reload
			$('a.y-wa-box').click(function(e){
				e.preventDefault();
				var href = $(this).attr('href') || '';
				var selected = null;
				var qIndex = href.indexOf('?');
				if(qIndex > -1){
					var params = new URLSearchParams(href.substring(qIndex + 1));
					selected = params.get('market');
				}
				if(selected){
					selectCoin(selected);
				}
			});
            

		function selectCoin(selected){
			// Normalize selected coin (strip trailing 'usdt' if present and lower-case)
			if(typeof selected === 'string'){
				selected = selected.toLowerCase().replace(/usdt$/i, '');
			}
			// stop existing timers if any
			try{ if(trade_list_timer) clearTimestampInterval(trade_list_timer); }catch(e){}
			try{ if(coin_data) clearTimestampInterval(coin_data); }catch(e){}

			coinname = selected;
			// Update UI elements
			$('#y-coinimg').attr('src','./contract_files/'+coinname+'.png');
			$('#y-xiazhubm').attr('src','./contract_files/'+coinname+'.png');
			$('.y-xdan-tl-txt-top').text(coinname.toLocaleUpperCase());
			$('#y-coinming').text(coinname.toLocaleUpperCase());

			// Update URL (history) so page reflects selection
			try{ history.pushState(null, null, '?market='+coinname); } catch(e){}

			// Update iframe
			const klineIframe = document.getElementById('kline-iframe');
			if(klineIframe){
				const marketSymbol = coinname + 'usdt';
				const iframeUrl = `https://www.bvoxf.com/views/contract/kline.html?market=${marketSymbol}`;
				klineIframe.src = iframeUrl;
			}

			// Refresh data & restart timers
			gettradlist();
			getcoin_data();
			trade_list_timer = setTimestampInterval(gettradlist,3000);
			coin_data = setTimestampInterval(getcoin_data,2000);

			// Close select modal
			$('.y-czxz-co').hide();
			$('#y-zhe3').hide();
		}
		
		function shuaxin(){
		    location.reload();
		}
	</script>

	<!-- Chart iframe loaded from external source -->


	<script src="./js/walletAuth.js" type="text/javascript" charset="utf-8"></script>
	</body></html>